#!/bin/bash

#$ -l highp,h_rt=10:00:00,h_data=20G
#$ -pe shared 1
#$ -N qualimpa_Coyote_BQR
#$ -cwd
#$ -m bea
#$ -o ./1P_4_qualimpa_BQR_Coyote.out
#$ -e ./1P_4_qualimpa_BQR_Coyote.err
#$ -M dechavezv

# then load your modules:
. /u/local/Modules/default/init/modules.sh
module load java/1.7.0_45

export SWAMP=/u/home/d/dechavez/project-rwayne/SWAMP/SWAMP.py
export Branch=/u/home/d/dechavez/project-rwayne/SWAMP/branch_canids.txt
export OUT=/u/home/d/dechavez/project-rwayne/SWAMP


echo '############'
echo Move_Control_files_rate_0
echo '############'

## for Dir in dir*; do (cd $Dir && /
## for dir in Tree*;do (cp codeml_modelA_rate_zero.ctl $dir/modelA/Omega1 && /
## cp codeml_modelA_masked.ctl $dir/modelA/Omega1 && / 
## cp codeml_modelAnull_masked.ctl $dir/modelA/Omega1  && /
## );done);done


echo '############'
echo PAML_annalysis_rate_0
echo '############'

## for Dir in dir*; do (cd $Dir && for dir in Tree*;do (cd $dir/modelA/Omega1 && /
## /u/home/d/dechavez/paml4.9d/bin/codeml codeml_modelA_rate_zero.ctl);done);done

## echo '#######################'
## echo Editing_phylip_files
## echo '######################'
## for Dir in dir*; do (cd $Dir && for dir in Tree*;do (cd $dir/modelA/Omega1 && for file in align.phy;do (perl -pe 's/([a-zA-Z]+)\s+/\1\n/g' $file > align_2.phy && rm align.phy && mv align_2.phy align.phy);done);done);done 

echo '#######################'
echo Runing_SWAMP.....
echo '######################'
for Dir in dir*; do (cd $Dir && for dir in Tree*; do (echo $dir && \
python ${SWAMP} -i $dir/modelA/Omega1 \
 -b ${Branch} -t 10 -w 15 --interscan);done);done


echo '############'
echo Move_Files
echo '############'
for Dir in dir*; do (cd $Dir && for dir in Tree*; do (cd $dir/modelA/Omega1 && cp align_masked.phy ../../modelAnull/Omega1);done);done
 
## echo '############'
## echo PAML_annalysis
### echo '############'

## for Dir in dir*; do (cd $Dir && for dir in Tree*;do (cd $dir/modelA/Omega1 && /
## /u/home/d/dechavez/paml4.9d/bin/codeml codeml_modelA_masked.ctl && /
## cd .. && cd .. && /
## cd modelAnull/Omega1 && /u/home/d/dechavez/paml4.9d/bin/codeml codeml_modelAnull_masked.ctl);done);done


## echo '#######################'
## echo Move_Files
## echo '######################'
for Dir in dir*; do (cd $Dir && for dir in Tree*; do (echo $dir && cd $dir/modelA/Omega1 && pwd && /
cp align_masked.phy $dir.phy && /
mv $dir.phy /u/home/d/dechavez/project-rwayne/SWAMP/SWAMP_sequneces_10in5);done);done
